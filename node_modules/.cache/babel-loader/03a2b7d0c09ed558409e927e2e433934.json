{"ast":null,"code":"import _regeneratorRuntime from \"/Users/gyan/Documents/ProjectGyan/Hackathons/HackMoney/web3react-demo-forked/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/gyan/Documents/ProjectGyan/Hackathons/HackMoney/web3react-demo-forked/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"/Users/gyan/Documents/ProjectGyan/Hackathons/HackMoney/web3react-demo-forked/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/gyan/Documents/ProjectGyan/Hackathons/HackMoney/web3react-demo-forked/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"/Users/gyan/Documents/ProjectGyan/Hackathons/HackMoney/web3react-demo-forked/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/gyan/Documents/ProjectGyan/Hackathons/HackMoney/web3react-demo-forked/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport EventEmitter from \"eventemitter3\";\nimport WalletConnect from \"@walletconnect/client\";\nimport QRCodeModal from \"@walletconnect/qrcode-modal\";\nimport { IJsonRpcConnection } from \"@walletconnect/jsonrpc-types\";\nimport { formatJsonRpcError } from \"@walletconnect/jsonrpc-utils\";\nexport var SignerConnection = /*#__PURE__*/function (_IJsonRpcConnection) {\n  _inherits(SignerConnection, _IJsonRpcConnection);\n\n  var _super = _createSuper(SignerConnection);\n\n  function SignerConnection(opts) {\n    var _this;\n\n    _classCallCheck(this, SignerConnection);\n\n    _this = _super.call(this);\n    _this.events = new EventEmitter();\n    _this.accounts = [];\n    _this.chainId = 1;\n    _this.pending = false;\n    _this.bridge = \"https://bridge.walletconnect.org\";\n    _this.qrcode = true;\n    _this.qrcodeModalOptions = undefined;\n    _this.opts = opts;\n    _this.chainId = (opts === null || opts === void 0 ? void 0 : opts.chainId) || _this.chainId;\n    _this.wc = _this.register(opts);\n    return _this;\n  }\n\n  _createClass(SignerConnection, [{\n    key: \"connected\",\n    get: function get() {\n      return typeof this.wc !== \"undefined\" && this.wc.connected;\n    }\n  }, {\n    key: \"connecting\",\n    get: function get() {\n      return this.pending;\n    }\n  }, {\n    key: \"connector\",\n    get: function get() {\n      this.wc = this.register(this.opts);\n      return this.wc;\n    }\n  }, {\n    key: \"on\",\n    value: function on(event, listener) {\n      this.events.on(event, listener);\n    }\n  }, {\n    key: \"once\",\n    value: function once(event, listener) {\n      this.events.once(event, listener);\n    }\n  }, {\n    key: \"off\",\n    value: function off(event, listener) {\n      this.events.off(event, listener);\n    }\n  }, {\n    key: \"removeListener\",\n    value: function removeListener(event, listener) {\n      this.events.removeListener(event, listener);\n    }\n  }, {\n    key: \"open\",\n    value: function () {\n      var _open = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(chainId) {\n        var _this2 = this;\n\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!this.connected) {\n                  _context.next = 3;\n                  break;\n                }\n\n                this.onOpen();\n                return _context.abrupt(\"return\");\n\n              case 3:\n                return _context.abrupt(\"return\", new Promise(function (resolve, reject) {\n                  _this2.on(\"error\", function (err) {\n                    reject(err);\n                  });\n\n                  _this2.on(\"open\", function () {\n                    resolve();\n                  });\n\n                  _this2.create(chainId);\n                }));\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function open(_x) {\n        return _open.apply(this, arguments);\n      }\n\n      return open;\n    }()\n  }, {\n    key: \"close\",\n    value: function () {\n      var _close = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!(typeof this.wc === \"undefined\")) {\n                  _context2.next = 2;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\");\n\n              case 2:\n                if (this.wc.connected) {\n                  this.wc.killSession();\n                }\n\n                this.onClose();\n\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function close() {\n        return _close.apply(this, arguments);\n      }\n\n      return close;\n    }()\n  }, {\n    key: \"send\",\n    value: function () {\n      var _send = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(payload) {\n        var _this3 = this;\n\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                this.wc = this.register(this.opts);\n\n                if (this.connected) {\n                  _context3.next = 4;\n                  break;\n                }\n\n                _context3.next = 4;\n                return this.open();\n\n              case 4:\n                this.sendPayload(payload).then(function (res) {\n                  return _this3.events.emit(\"payload\", res);\n                }).catch(function (e) {\n                  return _this3.events.emit(\"payload\", formatJsonRpcError(payload.id, e.message));\n                });\n\n              case 5:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function send(_x2) {\n        return _send.apply(this, arguments);\n      }\n\n      return send;\n    }()\n  }, {\n    key: \"register\",\n    value: function register(opts) {\n      if (this.wc) return this.wc;\n      this.opts = opts || this.opts;\n      this.bridge = (opts === null || opts === void 0 ? void 0 : opts.connector) ? opts.connector.bridge : (opts === null || opts === void 0 ? void 0 : opts.bridge) || \"https://bridge.walletconnect.org\";\n      this.qrcode = typeof (opts === null || opts === void 0 ? void 0 : opts.qrcode) === \"undefined\" || opts.qrcode !== false;\n      this.chainId = typeof (opts === null || opts === void 0 ? void 0 : opts.chainId) !== \"undefined\" ? opts.chainId : this.chainId;\n      this.qrcodeModalOptions = opts === null || opts === void 0 ? void 0 : opts.qrcodeModalOptions;\n      var connectorOpts = {\n        bridge: this.bridge,\n        qrcodeModal: this.qrcode ? QRCodeModal : undefined,\n        qrcodeModalOptions: this.qrcodeModalOptions,\n        storageId: opts === null || opts === void 0 ? void 0 : opts.storageId,\n        signingMethods: opts === null || opts === void 0 ? void 0 : opts.signingMethods,\n        clientMeta: opts === null || opts === void 0 ? void 0 : opts.clientMeta\n      };\n      this.wc = typeof (opts === null || opts === void 0 ? void 0 : opts.connector) !== \"undefined\" ? opts.connector : new WalletConnect(connectorOpts);\n\n      if (typeof this.wc === \"undefined\") {\n        throw new Error(\"Failed to register WalletConnect connector\");\n      }\n\n      if (this.wc.accounts.length) {\n        this.accounts = this.wc.accounts;\n      }\n\n      if (this.wc.chainId) {\n        this.chainId = this.wc.chainId;\n      }\n\n      this.registerConnectorEvents();\n      return this.wc;\n    }\n  }, {\n    key: \"onOpen\",\n    value: function onOpen(wc) {\n      this.pending = false;\n\n      if (wc) {\n        this.wc = wc;\n      }\n\n      this.events.emit(\"open\");\n    }\n  }, {\n    key: \"onClose\",\n    value: function onClose() {\n      this.pending = false;\n\n      if (this.wc) {\n        this.wc = undefined;\n      }\n\n      this.events.emit(\"close\");\n    }\n  }, {\n    key: \"onError\",\n    value: function onError(payload) {\n      var message = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"Failed or Rejected Request\";\n      var code = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : -32000;\n      var errorPayload = {\n        id: payload.id,\n        jsonrpc: payload.jsonrpc,\n        error: {\n          code: code,\n          message: message\n        }\n      };\n      this.events.emit(\"payload\", errorPayload);\n      return errorPayload;\n    }\n  }, {\n    key: \"create\",\n    value: function create(chainId) {\n      var _this4 = this;\n\n      this.wc = this.register(this.opts);\n      this.chainId = chainId || this.chainId;\n      if (this.connected || this.pending) return;\n      this.pending = true;\n      this.registerConnectorEvents();\n      this.wc.createSession({\n        chainId: this.chainId\n      }).then(function () {\n        return _this4.events.emit(\"created\");\n      }).catch(function (e) {\n        return _this4.events.emit(\"error\", e);\n      });\n    }\n  }, {\n    key: \"registerConnectorEvents\",\n    value: function registerConnectorEvents() {\n      var _this5 = this;\n\n      this.wc = this.register(this.opts);\n      this.wc.on(\"connect\", function (err) {\n        var _a, _b;\n\n        if (err) {\n          _this5.events.emit(\"error\", err);\n\n          return;\n        }\n\n        _this5.accounts = ((_a = _this5.wc) === null || _a === void 0 ? void 0 : _a.accounts) || [];\n        _this5.chainId = ((_b = _this5.wc) === null || _b === void 0 ? void 0 : _b.chainId) || _this5.chainId;\n\n        _this5.onOpen();\n      });\n      this.wc.on(\"disconnect\", function (err) {\n        if (err) {\n          _this5.events.emit(\"error\", err);\n\n          return;\n        }\n\n        _this5.onClose();\n      });\n      this.wc.on(\"modal_closed\", function () {\n        _this5.events.emit(\"error\", new Error(\"User closed modal\"));\n      });\n      this.wc.on(\"session_update\", function (error, payload) {\n        var _payload$params$ = payload.params[0],\n            accounts = _payload$params$.accounts,\n            chainId = _payload$params$.chainId;\n\n        if (!_this5.accounts || accounts && _this5.accounts !== accounts) {\n          _this5.accounts = accounts;\n\n          _this5.events.emit(\"accountsChanged\", accounts);\n        }\n\n        if (!_this5.chainId || chainId && _this5.chainId !== chainId) {\n          _this5.chainId = chainId;\n\n          _this5.events.emit(\"chainChanged\", chainId);\n        }\n      });\n    }\n  }, {\n    key: \"sendPayload\",\n    value: function () {\n      var _sendPayload = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(payload) {\n        var response;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                this.wc = this.register(this.opts);\n                _context4.prev = 1;\n                _context4.next = 4;\n                return this.wc.unsafeSend(payload);\n\n              case 4:\n                response = _context4.sent;\n                return _context4.abrupt(\"return\", this.sanitizeResponse(response));\n\n              case 8:\n                _context4.prev = 8;\n                _context4.t0 = _context4[\"catch\"](1);\n                return _context4.abrupt(\"return\", this.onError(payload, _context4.t0.message));\n\n              case 11:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this, [[1, 8]]);\n      }));\n\n      function sendPayload(_x3) {\n        return _sendPayload.apply(this, arguments);\n      }\n\n      return sendPayload;\n    }()\n  }, {\n    key: \"sanitizeResponse\",\n    value: function sanitizeResponse(response) {\n      return typeof response.error !== \"undefined\" && typeof response.error.code === \"undefined\" ? formatJsonRpcError(response.id, response.error.message) : response;\n    }\n  }]);\n\n  return SignerConnection;\n}(IJsonRpcConnection);\nexport default SignerConnection;","map":{"version":3,"sources":["../../src/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import EventEmitter from \"eventemitter3\";\nimport WalletConnect from \"@walletconnect/client\";\nimport QRCodeModal from \"@walletconnect/qrcode-modal\";\nimport { IJsonRpcConnection } from \"@walletconnect/jsonrpc-types\";\nimport { formatJsonRpcError } from \"@walletconnect/jsonrpc-utils\";\nexport class SignerConnection extends IJsonRpcConnection {\n    constructor(opts) {\n        super();\n        this.events = new EventEmitter();\n        this.accounts = [];\n        this.chainId = 1;\n        this.pending = false;\n        this.bridge = \"https://bridge.walletconnect.org\";\n        this.qrcode = true;\n        this.qrcodeModalOptions = undefined;\n        this.opts = opts;\n        this.chainId = (opts === null || opts === void 0 ? void 0 : opts.chainId) || this.chainId;\n        this.wc = this.register(opts);\n    }\n    get connected() {\n        return typeof this.wc !== \"undefined\" && this.wc.connected;\n    }\n    get connecting() {\n        return this.pending;\n    }\n    get connector() {\n        this.wc = this.register(this.opts);\n        return this.wc;\n    }\n    on(event, listener) {\n        this.events.on(event, listener);\n    }\n    once(event, listener) {\n        this.events.once(event, listener);\n    }\n    off(event, listener) {\n        this.events.off(event, listener);\n    }\n    removeListener(event, listener) {\n        this.events.removeListener(event, listener);\n    }\n    async open(chainId) {\n        if (this.connected) {\n            this.onOpen();\n            return;\n        }\n        return new Promise((resolve, reject) => {\n            this.on(\"error\", err => {\n                reject(err);\n            });\n            this.on(\"open\", () => {\n                resolve();\n            });\n            this.create(chainId);\n        });\n    }\n    async close() {\n        if (typeof this.wc === \"undefined\")\n            return;\n        if (this.wc.connected) {\n            this.wc.killSession();\n        }\n        this.onClose();\n    }\n    async send(payload) {\n        this.wc = this.register(this.opts);\n        if (!this.connected)\n            await this.open();\n        this.sendPayload(payload)\n            .then((res) => this.events.emit(\"payload\", res))\n            .catch(e => this.events.emit(\"payload\", formatJsonRpcError(payload.id, e.message)));\n    }\n    register(opts) {\n        if (this.wc)\n            return this.wc;\n        this.opts = opts || this.opts;\n        this.bridge = (opts === null || opts === void 0 ? void 0 : opts.connector)\n            ? opts.connector.bridge\n            : (opts === null || opts === void 0 ? void 0 : opts.bridge) || \"https://bridge.walletconnect.org\";\n        this.qrcode = typeof (opts === null || opts === void 0 ? void 0 : opts.qrcode) === \"undefined\" || opts.qrcode !== false;\n        this.chainId = typeof (opts === null || opts === void 0 ? void 0 : opts.chainId) !== \"undefined\" ? opts.chainId : this.chainId;\n        this.qrcodeModalOptions = opts === null || opts === void 0 ? void 0 : opts.qrcodeModalOptions;\n        const connectorOpts = {\n            bridge: this.bridge,\n            qrcodeModal: this.qrcode ? QRCodeModal : undefined,\n            qrcodeModalOptions: this.qrcodeModalOptions,\n            storageId: opts === null || opts === void 0 ? void 0 : opts.storageId,\n            signingMethods: opts === null || opts === void 0 ? void 0 : opts.signingMethods,\n            clientMeta: opts === null || opts === void 0 ? void 0 : opts.clientMeta,\n        };\n        this.wc =\n            typeof (opts === null || opts === void 0 ? void 0 : opts.connector) !== \"undefined\" ? opts.connector : new WalletConnect(connectorOpts);\n        if (typeof this.wc === \"undefined\") {\n            throw new Error(\"Failed to register WalletConnect connector\");\n        }\n        if (this.wc.accounts.length) {\n            this.accounts = this.wc.accounts;\n        }\n        if (this.wc.chainId) {\n            this.chainId = this.wc.chainId;\n        }\n        this.registerConnectorEvents();\n        return this.wc;\n    }\n    onOpen(wc) {\n        this.pending = false;\n        if (wc) {\n            this.wc = wc;\n        }\n        this.events.emit(\"open\");\n    }\n    onClose() {\n        this.pending = false;\n        if (this.wc) {\n            this.wc = undefined;\n        }\n        this.events.emit(\"close\");\n    }\n    onError(payload, message = \"Failed or Rejected Request\", code = -32000) {\n        const errorPayload = {\n            id: payload.id,\n            jsonrpc: payload.jsonrpc,\n            error: { code, message },\n        };\n        this.events.emit(\"payload\", errorPayload);\n        return errorPayload;\n    }\n    create(chainId) {\n        this.wc = this.register(this.opts);\n        this.chainId = chainId || this.chainId;\n        if (this.connected || this.pending)\n            return;\n        this.pending = true;\n        this.registerConnectorEvents();\n        this.wc\n            .createSession({ chainId: this.chainId })\n            .then(() => this.events.emit(\"created\"))\n            .catch((e) => this.events.emit(\"error\", e));\n    }\n    registerConnectorEvents() {\n        this.wc = this.register(this.opts);\n        this.wc.on(\"connect\", (err) => {\n            var _a, _b;\n            if (err) {\n                this.events.emit(\"error\", err);\n                return;\n            }\n            this.accounts = ((_a = this.wc) === null || _a === void 0 ? void 0 : _a.accounts) || [];\n            this.chainId = ((_b = this.wc) === null || _b === void 0 ? void 0 : _b.chainId) || this.chainId;\n            this.onOpen();\n        });\n        this.wc.on(\"disconnect\", (err) => {\n            if (err) {\n                this.events.emit(\"error\", err);\n                return;\n            }\n            this.onClose();\n        });\n        this.wc.on(\"modal_closed\", () => {\n            this.events.emit(\"error\", new Error(\"User closed modal\"));\n        });\n        this.wc.on(\"session_update\", (error, payload) => {\n            const { accounts, chainId } = payload.params[0];\n            if (!this.accounts || (accounts && this.accounts !== accounts)) {\n                this.accounts = accounts;\n                this.events.emit(\"accountsChanged\", accounts);\n            }\n            if (!this.chainId || (chainId && this.chainId !== chainId)) {\n                this.chainId = chainId;\n                this.events.emit(\"chainChanged\", chainId);\n            }\n        });\n    }\n    async sendPayload(payload) {\n        this.wc = this.register(this.opts);\n        try {\n            const response = await this.wc.unsafeSend(payload);\n            return this.sanitizeResponse(response);\n        }\n        catch (error) {\n            return this.onError(payload, error.message);\n        }\n    }\n    sanitizeResponse(response) {\n        return typeof response.error !== \"undefined\" &&\n            typeof response.error.code === \"undefined\"\n            ? formatJsonRpcError(response.id, response.error.message)\n            : response;\n    }\n}\nexport default SignerConnection;\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"module"}